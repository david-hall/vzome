<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <title>&lt;vzome-viewer&gt;</title>
    <link rel="stylesheet" href="./vzome-viewer.css">
    <script type="module">

      import "/modules/vzome-viewer.js"; // registers the custom element

      // document.querySelector("select").addEventListener("input", (e) => {
      //   document.querySelector("vzome-viewer").src = e.target.value;
      // })

      const customElement = document.querySelector("vzome-viewer");

      const sleep = ms => new Promise( resolve => setTimeout( resolve, ms ) );

      const BASE_URL = "https://raw.githubusercontent.com/John-Kostick/vzome-sharing/main/";

      let paths = []; // We'll use this as a stack

      const fetchNextDesign = async () =>
      {
        if ( paths.length === 0 ) return; // we're done
        // await sleep( 3000 ); // give the user a chance to see each model, and even interact
        const path = paths.shift(); // pop the next path off the stack
        customElement.src = BASE_URL + path;// triggers the worker to start loading,
          // which will result in another RENDER_COMPLETED event coming back
      }

      // The GitHub git/trees API returns a flat list of all blobs and trees
      fetch( "https://api.github.com/repos/John-Kostick/vzome-sharing/git/trees/main?recursive=1" )
        .then( response => response.json() )
        .then( json => {
          const allPaths = json.tree.filter( entry => entry.type==="blob" && entry.path.endsWith( '.vZome' ) )
            .map( entry => entry.path );
          console.log( 'Repo has', allPaths.length, 'entries.' );
          return allPaths.slice( 340 );
        } )
        .then( pathsToTry => {
          paths = pathsToTry; // Initialize the full stack
          console.log( 'pathsToTry has', paths.length, 'entries.' );
          customElement .addEventListener( "vzome-design-rendered", fetchNextDesign );
          const path = paths.shift(); // pop the first path off the stack
          customElement.src = BASE_URL + path;// triggers the worker to start loading,
            // which will result in the RENDER_COMPLETED event coming back
        } );

    </script>
  </head>
  <body>
    <section>
      <vzome-viewer>
      </vzome-viewer>
<!-- 
      <select>
        <option value="https://raw.githubusercontent.com/vorth/vzome-sharing/main/2021/10/28/14-19-45-THC-SV-colored/THC-SV-colored.vZome">THC Molecule</option>
        <option selected value="/models/orangePurpleChiral.vZome">Affine Dodecahedron</option>
        <option value="/models/hept-test.vZome">Heptagon Test</option>
        <option value="/models/C240.vZome">C240 Buckyball</option>
        <option value="/models/vZomeLogo.vZome">vZome Logo</option>
        <option value="">(none)</option>
      </select> -->

    </section>
    <!-- <section>
      <vzome-viewer src="https://raw.githubusercontent.com/vorth/vzome-sharing/main/2021/10/28/14-19-45-THC-SV-colored/THC-SV-colored.vZome">
      </vzome-viewer>
    </section> -->
  </body>
</html>
